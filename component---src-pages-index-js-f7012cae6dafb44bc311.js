(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{142:function(e,t,a){"use strict";a.r(t);var s=a(146),n=a.n(s),o=(a(145),a(148)),i=a.n(o),r=(a(33),a(34),a(7)),u=a.n(r),c=a(0),l=a.n(c),m=a(149),p=a.n(m),d=(a(143),a(150));p.a.accessToken="pk.eyJ1Ijoic2FhZGlxbSIsImEiOiJjamJpMXcxa3AyMG9zMzNyNmdxNDlneGRvIn0.wjlI8r1S_-xxtq2d-W5qPA";var h=null,f=null,y=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={lng:-114.0708,lat:51.0486,zoom:10.2,selected_bus:null},a}u()(t,e);var a=t.prototype;return a.setStateAsync=function(e){var t=this;return new Promise(function(a){t.setState(e,a)})},a.componentDidMount=function(){var e=this;if("undefined"!=typeof window){var t=this.state,a=t.lng,s=t.lat,n=t.zoom;this.map=new p.a.Map({container:this.mapContainer,style:"mapbox://styles/saadiqm/cju238axg1xac1fqi1xisuwwa",center:[a,s],zoom:n,maxZoom:12,minZoom:10.2}),this.map.on("load",function(){var t="https://data.calgary.ca/resource/hpnd-riq4.geojson?route_short_name="+e.state.selected_bus;e.map.addSource("Bus Route",{type:"geojson",data:t}),e.map.addLayer({id:"Bus Route",type:"line",source:"Bus Route",paint:{"line-color":"#FF0000","line-width":5,"line-opacity":.7},layout:{"line-join":"round","line-cap":"round"}});var a="https://dax2h6sk92.execute-api.us-east-1.amazonaws.com/dev/";e.map.addSource("Realtime Bus",{type:"geojson",data:a}),e.map.addLayer({id:"Realtime Bus",type:"circle",source:"Realtime Bus",paint:{"circle-color":["case",["boolean",["feature-state","click"],!1],"#f4cb42","#ff0000"],"circle-radius":["case",["boolean",["feature-state","click_radius"],!1],9,7],"circle-opacity":["case",["boolean",["feature-state","hover"],!1],1,.5]}}),e.map.addLayer({id:"symbols",type:"symbol",source:"Bus Route",layout:{"icon-image":"bus","icon-text-fit":"none","icon-text-fit-padding":[3,3,3,3],"symbol-placement":"line","symbol-spacing":1e3,"icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-size":12,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-transform":"uppercase","text-letter-spacing":.05,"text-offset":[0,0]},paint:{"text-color":"red"}}),e.map.on("mousemove","Realtime Bus",e.move.bind(e)),e.map.on("mouseleave","Realtime Bus",e.leave.bind(e)),e.map.on("click","Realtime Bus",e.click.bind(e)),setInterval(function(){e.map.getSource("Realtime Bus").setData(a),console.log("update map")},45e3)})}},a.move=function(e){this.map.getCanvas().style.cursor="pointer",e.features.length>0&&(h&&this.map.setFeatureState({source:"Realtime Bus",id:h},{hover:!1}),h=e.features[0].id,this.map.setFeatureState({source:"Realtime Bus",id:h},{hover:!0}))},a.leave=function(e){this.map.getCanvas().style.cursor="",h&&this.map.setFeatureState({source:"Realtime Bus",id:h},{hover:!1}),f&&this.map.setFeatureState({source:"Realtime Bus",id:f},{hover:!0}),h=null},a.click=function(){var e=i()(n.a.mark(function e(t){var a,s,o,i,r,u,c,l,m,p;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.map.getCanvas().style.cursor="pointer",!(t.features.length>0)){e.next=30;break}return f&&(this.map.setFeatureState({source:"Realtime Bus",id:f},{click:!1}),this.map.setFeatureState({source:"Realtime Bus",id:f},{hover:!1}),this.map.setFeatureState({source:"Realtime Bus",id:f},{click_radius:!1})),f=t.features[0].id,this.map.setFeatureState({source:"Realtime Bus",id:f},{click:!0}),this.map.setFeatureState({source:"Realtime Bus",id:f},{click_radius:!0}),a=parseInt(t.features[0].properties.trip_id),s="https://vkyer20d0m.execute-api.us-west-2.amazonaws.com/dev/trips/"+a,e.next=10,fetch(s);case 10:return o=e.sent,e.next=13,o.json();case 13:if(i=e.sent,!(r=i.route_short_name)){e.next=30;break}return e.next=18,this.setStateAsync({selected_bus:r});case 18:return u="https://data.calgary.ca/resource/hpnd-riq4.geojson?route_short_name="+this.state.selected_bus,e.next=21,fetch(u);case 21:return c=e.sent,e.next=24,c.json();case 24:l=e.sent,m=Object(d.center)(l),p=m.geometry.coordinates,this.map.flyTo({center:p,zoom:12}),this.map.getSource("Bus Route").setData(u),this.map.setLayoutProperty("symbols","text-field",String(this.state.selected_bus));case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.render=function(){var e=this;return l.a.createElement("div",{ref:function(t){return e.mapContainer=t},style:{position:"absolute",top:0,bottom:0,width:"100%",height:"100%"}})},t}(c.Component);t.default=y}}]);
//# sourceMappingURL=component---src-pages-index-js-f7012cae6dafb44bc311.js.map