(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{149:function(t,e,a){"use strict";a.r(e);var s=a(151),n=a.n(s),o=(a(150),a(153)),i=a.n(o),r=(a(36),a(37),a(38)),u=a.n(r),c=a(7),l=a.n(c),m=a(157),p=a(9),d=a(0),h=a(154),b=a.n(h),f=(a(146),a(155)),g=a(156),v=a.n(g),y=a(147),x=a.n(y),S=function(t){return Object(p.b)("div",{className:x.a.container},Object(p.b)("h1",null,Object(p.b)("span",{className:x.a.underline},t.busCount)," BUSES ON THE ROAD"),Object(p.b)("h2",null,t.routeShortName," - ",t.routeLongName),Object(p.b)("p",null,t.busID),Object(p.b)("p",null,"Calgary Transit realtime feed is updated every 45 seconds. This map is for visualization purposes only. For trip planning, visit calgarytransit.com"),Object(p.b)("p",null,"Â©2019 Saadiq Mohiuddin www.saadiqm.com"))},w=Object(m.a)("div",{target:"e12h3s7g0"})({name:"cdhqau",styles:"display:inline-block;position:absolute;bottom:50px;left:50px;padding:0;margin:0;"});b.a.accessToken="pk.eyJ1Ijoic2FhZGlxbSIsImEiOiJjamJpMXcxa3AyMG9zMzNyNmdxNDlneGRvIn0.wjlI8r1S_-xxtq2d-W5qPA";var _=null,j=null,k=function(t){function e(e){var a;return(a=t.call(this,e)||this).count_bus_num=a.count_bus_num.bind(u()(a)),a.state={lng:-114.0708,lat:51.0486,zoom:10.2,selected_bus:null,num_buses:null,route_short_name:null,route_long_name:null,bus_id:null},a}l()(e,t);var a=e.prototype;return a.setStateAsync=function(t){var e=this;return new Promise(function(a){e.setState(t,a)})},a.componentDidMount=function(){var t=this,e=this.state,a=e.lng,s=e.lat,n=e.zoom;this.map=new b.a.Map({container:this.mapContainer,style:"mapbox://styles/saadiqm/cju238axg1xac1fqi1xisuwwa",center:[a,s],zoom:n,maxZoom:12,minZoom:10.2}),this.map.on("load",function(){var e="https://data.calgary.ca/resource/hpnd-riq4.geojson?route_short_name="+t.state.selected_bus;t.map.addSource("Bus Route",{type:"geojson",data:e}),t.map.addLayer({id:"Bus Route",type:"line",source:"Bus Route",paint:{"line-color":"#FF0000","line-width":5,"line-opacity":.7},layout:{"line-join":"round","line-cap":"round"}});t.map.addSource("Realtime Bus",{type:"geojson",data:"http://localhost:3000/"}),t.map.addLayer({id:"Realtime Bus",type:"circle",source:"Realtime Bus",paint:{"circle-color":["case",["boolean",["feature-state","click"],!1],"#f4cb42","#ff0000"],"circle-radius":["case",["boolean",["feature-state","click_radius"],!1],9,7],"circle-opacity":["case",["boolean",["feature-state","hover"],!1],1,.5]}});var a=new Image(27,27);a.onload=function(){return t.map.addImage("bus",a)},a.src=v.a,t.map.addLayer({id:"symbols",type:"symbol",source:"Bus Route",layout:{"icon-image":"bus","icon-text-fit":"none","icon-text-fit-padding":[3,3,3,3],"symbol-placement":"line","symbol-spacing":1e3,"icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-size":12,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-transform":"uppercase","text-letter-spacing":.05,"text-offset":[0,0]},paint:{"text-color":"red"}}),t.map.on("mousemove","Realtime Bus",t.move.bind(t)),t.map.on("mouseleave","Realtime Bus",t.leave.bind(t)),t.map.on("click","Realtime Bus",t.click.bind(t)),t.count_bus_num("http://localhost:3000/");var s=0,n=setInterval(function(){3===(s+=1)&&clearInterval(n),t.map.getSource("Realtime Bus").setData("http://localhost:3000/"),console.log("map updated: "+s),t.count_bus_num("http://localhost:3000/")},45e3)})},a.count_bus_num=function(){var t=i()(n.a.mark(function t(e){var a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return a=t.sent,t.next=5,a.json();case 5:s=t.sent,this.setState({num_buses:s.features.length});case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),a.move=function(t){this.map.getCanvas().style.cursor="pointer",t.features.length>0&&(_&&this.map.setFeatureState({source:"Realtime Bus",id:_},{hover:!1}),_=t.features[0].id,this.map.setFeatureState({source:"Realtime Bus",id:_},{hover:!0}))},a.leave=function(t){this.map.getCanvas().style.cursor="",_&&this.map.setFeatureState({source:"Realtime Bus",id:_},{hover:!1}),j&&this.map.setFeatureState({source:"Realtime Bus",id:j},{hover:!0}),_=null},a.click=function(){var t=i()(n.a.mark(function t(e){var a,s,o,i,r,u,c,l,m;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.map.getCanvas().style.cursor="pointer",this.setState({bus_id:e.features[0].id}),!(e.features.length>0)){t.next=30;break}return j&&(this.map.setFeatureState({source:"Realtime Bus",id:j},{click:!1}),this.map.setFeatureState({source:"Realtime Bus",id:j},{hover:!1}),this.map.setFeatureState({source:"Realtime Bus",id:j},{click_radius:!1})),j=e.features[0].id,this.map.setFeatureState({source:"Realtime Bus",id:j},{click:!0}),this.map.setFeatureState({source:"Realtime Bus",id:j},{click_radius:!0}),a=parseInt(e.features[0].properties.trip_id),s="https://vkyer20d0m.execute-api.us-west-2.amazonaws.com/dev/trips/"+a,t.next=11,fetch(s);case 11:return o=t.sent,t.next=14,o.json();case 14:if(i=t.sent,r=i.route_short_name,this.setState({route_long_name:i.route_long_name}),this.setState({route_short_name:r}),!r){t.next=30;break}return u="https://data.calgary.ca/resource/hpnd-riq4.geojson?route_short_name="+this.state.route_short_name,t.next=22,fetch(u);case 22:return c=t.sent,t.next=25,c.json();case 25:l=t.sent,m=Object(f.bbox)(l),this.map.fitBounds(m,{padding:{top:50,bottom:50,left:50,right:50}}),this.map.getSource("Bus Route").setData(u),this.map.setLayoutProperty("symbols","text-field",String(this.state.route_short_name));case 30:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),a.render=function(){var t=this;return Object(p.b)("div",null,Object(p.b)("div",{ref:function(e){return t.mapContainer=e},style:{position:"absolute",top:0,bottom:0,width:"100%",height:"100%"}}),Object(p.b)(w,null,Object(p.b)(S,{busCount:this.state.num_buses,routeShortName:this.state.route_short_name?this.state.route_short_name:"",routeLongName:this.state.route_long_name})))},e}(d.Component);e.default=k},156:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAADX0lEQVRogeXbz2tcVRjG8U+uEjdqhFZBU4TulNKFWhSLJk3VhUsttdC10r/AvW7dCBbbhduikFK7UJCCVZgEglJRid1akCoYjaS1q5JwXLwzdRznzkxm7o/OzBdmce+cOfM83HPuPfc97zuTUlISc3geh3AA+zGPh3B/s80tbOE3/IyruII13ChD1EzBhvfhBF7Hc7hnyH528A0+xXn8Uog6SCkV8VlIKX2WUtpOxbPd7HuxCK2jdnAkpdQowWQejeZ/Vm740ZTSuQoM5nGuqWHX2oeZw8fxkbgp1ckNvCXm+MBku2g7i9NYVr9ZQsOy0HTfoD8a9Ao/gIt4aShp5dPAa/irX8NBDD+ML/DM6LpK5Ue8gj96NepneA5f4enidJXK91jSY9HSaw7Pigf/uJiFp4Tm2bwGvQy/j6NFK6qAo0J7V/KG9HFxBxxnTujioZvhefwkFvnjzBYO4nr7yW5D+rTxN0t4+KDzZOcVXhJ35UniZVxuHXQaXsELVSsqmVW82DpoH9ILJs8s4WmhddBu+O3qtVTGHW+tIf0IfsW9dSkqmW3x9NloXeGTJtcs4e0k/w7pY/VpqYxjxJCew6bhA27jwg72ZDhs8s0SHg9nxuttaFQOZWK9OS0cyMSOwLSwP8NjdauokPnMZLwZDcqDM2mIwPQ4s5u49CRwOxNbltPCrUyEQqaFvzOxGT0t/J7hWt0qKuRaJiKU08LVDN/VraJCrkzb6+HeTGw8rdUspgrWsNVaeFyoU0lFXGCKg3gbuFSfntK5JDz+Zy39Xj1aKuGOt3bDDbEtMWmsCm/4/9vSO5VKqYZ32w86DV8W2TqTwkV82X6i24b4Pqwb/0jIwBvi13GqCkUlc0qHWfIjHss4W6qccjkrJ0elV57WrHh+HSlHU2k0RILa7W5f9ktM24OvjU+wfl2kbWzmNegXxNsUORI/FCiqLNaF1lyzDBa13MCiuNJ3Kyti6m30azhomPYmXsWHw2sqjTNizvbNpGW4Io+7JUH8Jt5UYoJ4i/N4Eh8P8dui+ARP2KVZFFLksVJ4RUM+qymlpVE0F1XGs5hS+jyltFOCyZ1m34tFaC26UOtxvCEKtZ41WqHWtyL3eVmBhVpFG26nvRTvoNh436t7Kd6fYkNgXcmleP8AjUHINmktS24AAAAASUVORK5CYII="}}]);
//# sourceMappingURL=component---src-pages-index-js-0e6a1fc26b12aa136192.js.map